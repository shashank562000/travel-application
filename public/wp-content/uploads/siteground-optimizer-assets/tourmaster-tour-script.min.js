(function(a){"use strict";var b='desktop',g;typeof window.matchMedia=='function'?(a(window).on('resize tourmaster-set-display',function(){window.matchMedia('(max-width: 419px)').matches?b='mobile-portrait':window.matchMedia('(max-width: 767px)').matches?b='mobile-landscape':window.matchMedia('(max-width: 999px)').matches?b='tablet':b='desktop'}),a(window).trigger('tourmaster-set-display')):(a(window).on('resize tourmaster-set-display',function(){a(window).innerWidth()<=419?b='mobile-portrait':a(window).innerWidth()<=767?b='mobile-landscape':a(window).innerWidth()<=999?b='tablet':b='desktop'}),a(window).trigger('tourmaster-set-display')),a.fn.tourmaster_datepicker=function(){a(this).each(function(){var j=a(this),c=a(this).closest('.tourmaster-datepicker-wrap'),d=a(this).siblings('.tourmaster-datepicker-alt'),i=a(this).attr('data-date-format'),k,e,b,f,g;a(this).attr('data-tour-date')?(k=a(this).attr('data-tour-range'),e=JSON.parse(a(this).attr('data-tour-date')),b=a(this).val(),f=b,a(this).datepicker({dateFormat:i,altFormat:'yy-mm-dd',altField:d,changeMonth:!0,changeYear:!0,minDate:new Date(e[0]),maxDate:new Date(e[e.length-1]),beforeShowDay:function(c){var a,d;return b=c.getFullYear()+'-',b+=('0'+(c.getMonth()+1)).slice(-2)+'-',b+=('0'+c.getDate()).slice(-2),a='',d=h(f,b),d>=0&&d<k&&(a='tourmaster-highlight'),e.indexOf(b)>=0?[!0,a,'']:[!1,a,'']},onSelect:function(b,a){f=a.selectedYear+'-',f+=('0'+(a.selectedMonth+1)).slice(-2)+'-',f+=('0'+a.selectedDay).slice(-2),d.trigger('change')},beforeShow:function(c,d){var b=a(d).datepicker('widget');a("body").hasClass("rtl")?b.css('margin-left',b.outerWidth()-a(c).outerWidth()):b.css('margin-left',a(c).outerWidth()-b.outerWidth()),b.css('margin-top',-2)},closeText:TMi18n.closeText,currentText:TMi18n.currentText,monthNames:TMi18n.monthNames,monthNamesShort:TMi18n.monthNamesShort,dayNames:TMi18n.dayNames,dayNamesShort:TMi18n.dayNamesShort,dayNamesMin:TMi18n.dayNamesMin,firstDay:TMi18n.firstDay}),g=new Date(b+'T00:00:00+00:00'),g=new Date(g.getTime()+g.getTimezoneOffset()*6e4),a(this).datepicker('setDate',g)):(j.val()&&c.addClass('tourmaster-with-date'),a(this).datepicker({dateFormat:i,altFormat:'yy-mm-dd',altField:d,changeMonth:!0,changeYear:!0,minDate:new Date,onSelect:function(){c.addClass('tourmaster-with-date')}}),c.on('click','.tourmaster-clear-date',function(){j.val(''),d.val(''),c.removeClass('tourmaster-with-date')}))})};function h(c,d){var a=new Date(c),b=new Date(d);return Math.floor((Date.UTC(b.getFullYear(),b.getMonth(),b.getDate())-Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()))/(1e3*60*60*24))}function d(d,b,c){var b=a.extend({beforeSend:function(a,b){},error:function(a,b,c){console.log(a,b,c)},success:function(a){}},b);c=a.extend({action:'tourmaster_tour_booking'},c),a.ajax({type:'POST',url:d,data:c,dataType:'json',beforeSend:b.beforeSend,error:b.error,success:b.success})}function f(c){var b={};return c.find('input[name], select[name], textarea[name]').each(function(){var c=a(this).attr('name');c.lastIndexOf('[]')==c.length-2?(c=c.substr(0,c.length-2),typeof b[c]!='object'&&(b[c]=[]),b[c].push(a(this).val())):b[c]=a(this).val()}),b}function c(c){var b={};return c.find('input[name], select[name], textarea[name]').each(function(){var c=a(this).attr('name'),d;if(a(this).is('[type="checkbox"]'))d=a(this).is(':checked')?a(this).val():0;else if(a(this).is('[type="radio"]'))if(a(this).is(':checked'))d=a(this).val();else return;else d=a(this).val();c.lastIndexOf('[]')==c.length-2?(c=c.substr(0,c.length-2),typeof b[c]!='object'&&(b[c]=[]),b[c].push(d)):b[a(this).attr('name')]=d}),b}a.fn.tourmaster_tour_booking=function(){var b=a(this),e=a(this).attr('data-ajax-url');a(this).on('change','input[name="tour-date"], select[name="tour-date"]',function(){var c=f(b);c.step=1,b.find('[data-step]').each(function(){a(this).attr('data-step')>1&&a(this).slideUp(200,function(){a(this).remove()})}),d(e,{success:function(d){if(typeof d.content!='undefined'){b.find('[data-step]').each(function(){a(this).attr('data-step')>1&&a(this).slideUp(200,function(){a(this).remove()})});var c=a(d.content).hide();b.append(c),c.find('.tourmaster-datepicker').tourmaster_datepicker(),c.slideDown(200)}}},{data:c})}),a(this).on('change','input[name="package"]',function(){var c=f(b);c.step=2,b.find('[data-step]').each(function(){a(this).attr('data-step')>2&&a(this).slideUp(200,function(){a(this).remove()})}),d(e,{success:function(d){if(typeof d.content!='undefined'){var c=a(d.content).hide();b.append(c),c.find('.tourmaster-datepicker').tourmaster_datepicker(),c.slideDown(200)}}},{data:c})}),a(this).on('change','select[name="tour-room"]',function(){var f=a(this).closest('.tourmaster-tour-booking-room'),h=f.siblings('.tourmaster-tour-booking-room-template').children(),b=f.siblings('.tourmaster-tour-booking-people-container'),e=!1,d,g,c;if(a(this).val()&&b.length==0&&(b=a('<div class="tourmaster-tour-booking-people-container" data-step="999" ></div>').hide(),b.insertAfter(f),e=!0),a(this).val()){if(d=parseInt(a(this).val())-b.children().length,d>0){for(g=0;g<d;g++)c=h.clone(),c.attr('data-step',4),c.find('.tourmaster-tour-booking-room-text > span').html(b.children().length+1),b.append(c),e||(c.hide(),c.slideDown(200))}else d<0&&b.children('div').slice(d).slideUp(200,function(){a(this).remove()});e&&b.slideDown(200)}else b.length>0&&b.slideUp(200,function(){a(this).remove()})}),a(this).hasClass('tourmaster-update-header-price')&&a(this).on('change','input, select',function(){var f=c(b);d(e,{success:function(c){if(typeof c.price!='undefined'){var b=a('.tourmaster-header-price');b.find('.tourmaster-tour-discount-price').remove(),b.find('.tourmaster-tour-price-wrap').removeClass('tourmaster-discount'),b.addClass('tourmaster-price-updated').find('.tourmaster-tour-price .tourmaster-tail').html(c.price),a(window).trigger('resize')}}},{action:'tourmaster_update_head_price',data:f})}),a(this).on('click','input[type="submit"]',function(){var f=a(this),j=a(this).siblings('.tourmaster-tour-booking-submit-error'),l=!0,m,h,n,i,g,o,p,k;return b.find('input[data-required], select[data-required], textarea[data-required]').each(function(){a(this).val()||(l=!1)}),!l?(j.slideDown(200),!1):(m={},b.find('.tourmaster-extra-booking-field').find('input, select, textarea').each(function(){m[a(this).attr('name')]=a(this).val()}),h=!0,n='',i=0,g=0,o=0,p=0,k=0,j.filter('.tourmaster-temp').slideUp(200,function(){a(this).remove()}),b.find('[data-step]').each(function(){var c=a(this).attr('data-step'),d,b;c==1||c==2||c==3?a(this).find('input[name], select[name]').each(function(){a(this).val()==""?h=!1:a(this).attr('name')=='package'&&(n=a(this).val())}):c==4&&(d=0,b=0,a(this).find('select[name], input[name]').each(function(){a(this).attr('name')=='group'?(i='group',g='group'):a(this).val()!=""&&(b+=parseInt(a(this).val()),a(this).is('[name^="tour-adult"], [name^="tour-people"]')?g+=b:a(this).is('[name^="tour-male"]')?(o+=b,g+=b):a(this).is('[name^="tour-female"]')&&(p+=b,g+=b))}),d+=b,b>k&&(k=b),i!='group'&&(d<=0?h=!1:i+=d))}),h?(j.slideUp(200),f.animate({opacity:.5}),d(e,{success:function(i){var d,e,g,j;i.status=='success'?h&&f.attr('data-ask-login')?(d=f.siblings('[data-tmlb-id="'+f.attr('data-ask-login')+'"]'),d.length==0&&(d=b.closest('form').siblings('[data-tmlb-id="'+f.attr('data-ask-login')+'"]')),e=d.clone(),e.find('.nsl-container-block').length>0&&e.find('.nsl-container-block').replaceWith(d.find('.nsl-container-block').clone(!0)),tourmaster_lightbox(e),g=c(b),tourmaster_set_cookie('tourmaster-booking-detail',JSON.stringify(g),0)):(g=c(b),tourmaster_set_cookie('tourmaster-booking-detail',JSON.stringify(g),0),b.submit()):typeof i.message!='undefined'&&(j=a('<div class="tourmaster-tour-booking-submit-error tourmaster-temp" ></div>').html(i.message),j.insertAfter(f),j.slideDown(200)),f.animate({opacity:1})}},{action:'tourmaster_tour_booking_amount_check',tid:b.find('[name="tid"]').val(),tour_id:b.find('[name="tour-id"]').val(),tour_date:b.find('[name="tour-date"]').val(),traveller:i,adult_amount:g,male_amount:o,female_amount:p,package:n,max_traveller_per_room:k,extra_booking_info:m})):j.slideDown(200),!1)})},a.fn.tourmaster_tour_booking_sticky=function(){a(this).each(function(){var f=a(this).closest('.tourmaster-page-wrapper'),k=f.children('.tourmaster-template-wrapper'),c=a(this),d=a(this).siblings('.tourmaster-tour-booking-bar-anchor'),g=parseInt(a('html').css('margin-top')),i=parseInt(d.css('margin-left')),j=parseInt(d.css('margin-right')),h,e,l;f.hasClass('tourmaster-tour-style-1')&&(a(this).addClass('tourmaster-start-script'),f.siblings('.tourmaster-single-header').addClass('tourmaster-start-script'),h=a(this).children('.tourmaster-tour-booking-bar-outer').children('.tourmaster-header-price'),c.css('margin-top',-h.outerHeight()),d.css('margin-top',-h.outerHeight()),f.css('min-height',c.height()-h.outerHeight()),a(window).resize(function(){c.css('margin-top',-h.outerHeight()),d.css('margin-top',-h.outerHeight()),f.css('min-height',c.height()-h.outerHeight()),a("body").hasClass("rtl")?c.css({position:'',top:'',right:'','margin-top':d.css('margin-top')}):c.css({position:'',top:'',left:'','margin-top':d.css('margin-top')}),c.removeClass('tourmaster-fixed tourmaster-top tourmaster-bottom tourmaster-lock')})),e=0,l=0,a(window).on('scroll resize',function(){var h,m;if(!d.length)return;h=!0,(b=='mobile-landscape'||b=='mobile-portrait'||b=='tablet')&&(h=!1),m=l>a(window).scrollTop()?'up':'down',l=a(window).scrollTop(),h&&a(window).scrollTop()+g+e>d.offset().top?a(window).height()>c.outerHeight()+e?a(window).scrollTop()+c.outerHeight()+g+e*2>f.offset().top+f.outerHeight()?c.hasClass('tourmaster-fixed-lock')||(a("body").hasClass("rtl")?c.css({position:'absolute',top:k.outerHeight()-c.outerHeight()-e,right:'auto','margin-top':0}):c.css({position:'absolute',top:k.outerHeight()-c.outerHeight()-e,left:'auto','margin-top':0}),c.removeClass('tourmaster-fixed'),c.addClass('tourmaster-fixed-lock')):c.hasClass('tourmaster-fixed')?c.hasClass('tourmaster-fixed')&&(a("body").hasClass("rtl")?c.css({right:a(window).width()-(d.offset().left+d.outerWidth())-j}):c.css({left:d.offset().left-i})):(a("body").hasClass("rtl")?c.css({position:'fixed',top:e+g,right:a(window).width()-(d.offset().left+d.outerWidth())-j,'margin-top':0}):c.css({position:'fixed',top:e+g,left:d.offset().left-i,'margin-top':0}),c.removeClass('tourmaster-fixed-lock'),c.addClass('tourmaster-fixed')):m=='down'?c.hasClass('tourmaster-top')?(a("body").hasClass("rtl")?c.css({position:'absolute',top:a(window).scrollTop()+e+g-c.parent().offset().top,right:'auto','margin-top':0}):c.css({position:'absolute',top:a(window).scrollTop()+e+g-c.parent().offset().top,left:'auto','margin-top':0}),c.removeClass('tourmaster-top'),c.addClass('tourmaster-lock')):a(window).scrollTop()+a(window).height()>f.offset().top+f.outerHeight()?c.hasClass('tourmaster-lock')||(a("body").hasClass("rtl")?c.css({position:'absolute',top:k.outerHeight()-c.outerHeight(),right:'auto','margin-top':0}):c.css({position:'absolute',top:k.outerHeight()-c.outerHeight(),left:'auto','margin-top':0}),c.removeClass('tourmaster-bottom'),c.addClass('tourmaster-lock')):a(window).scrollTop()+a(window).height()>c.offset().top+c.outerHeight()?c.hasClass('tourmaster-bottom')||(a("body").hasClass("rtl")?c.css({position:'fixed',top:a(window).height()-c.outerHeight(),right:a(window).width()-(d.offset().left+d.outerWidth())-j,'margin-top':0}):c.css({position:'fixed',top:a(window).height()-c.outerHeight(),left:d.offset().left-i,'margin-top':0}),c.removeClass('tourmaster-top tourmaster-lock'),c.addClass('tourmaster-bottom')):c.hasClass('tourmaster-bottom')&&(a("body").hasClass("rtl")?c.css({right:a(window).width()-(d.offset().left+d.outerWidth())-j}):c.css({left:d.offset().left-i})):c.hasClass('tourmaster-bottom')?(a("body").hasClass("rtl")?c.css({position:'absolute',top:a(window).scrollTop()+a(window).height()-c.outerHeight()-c.parent().offset().top,right:'auto','margin-top':0}):c.css({position:'absolute',top:a(window).scrollTop()+a(window).height()-c.outerHeight()-c.parent().offset().top,left:'auto','margin-top':0}),c.removeClass('tourmaster-bottom'),c.addClass('tourmaster-lock')):c.hasClass('tourmaster-lock')&&a(window).scrollTop()+g+e<c.offset().top&&(a("body").hasClass("rtl")?c.css({position:'fixed',top:e+g,right:a(window).width()-(d.offset().left+d.outerWidth())-j,'margin-top':0}):c.css({position:'fixed',top:e+g,left:d.offset().left-i,'margin-top':0}),c.removeClass('tourmaster-bottom tourmaster-lock'),c.addClass('tourmaster-top')):(c.hasClass('tourmaster-fixed')||c.hasClass('tourmaster-top')||c.hasClass('tourmaster-bottom')||c.hasClass('tourmaster-lock'))&&(a("body").hasClass("rtl")?c.css({position:'',top:'',right:'','margin-top':d.css('margin-top')}):c.css({position:'',top:'',left:'','margin-top':d.css('margin-top')}),c.removeClass('tourmaster-fixed tourmaster-top tourmaster-bottom tourmaster-lock'))})})},g=function(){var b=this;b.form=a('#tourmaster-payment-template-wrapper'),b.sidebar=b.form.find('#tourmaster-tour-booking-bar-inner'),b.content=b.form.find('#tourmaster-tour-payment-content'),b.payment_step=a('#tourmaster-payment-step-wrap'),b.payment_template=a('#tourmaster-page-wrapper'),b.init()},g.prototype={init:function(){var b=this;b.bind_script(),b.bind_script_recurring(),b.form.on('click','.tourmaster-payment-step',function(){var c=b.get_booking_detail();a(this).attr('data-name')&&(c[a(this).attr('data-name')]=a(this).attr('data-value')),a(this).attr('data-step')&&(c.step=a(this).attr('data-step')),b.check_required_field(c.step)&&b.change_step({booking_detail:c})}),b.payment_step.on('click','.tourmaster-payment-step-item',function(){if(a(this).hasClass('tourmaster-enable')){var c=b.get_booking_detail();a(this).attr('data-step')&&(c.step=a(this).attr('data-step')),b.check_required_field(c.step)&&b.change_step({booking_detail:c})}}),b.form.on('change input','.tourmaster-payment-service-form-wrap input',tourmaster_debounce(function(c){if(c.type=='change'&&a(c.target).is('input[type="text"]'))return;var d=b.get_booking_detail();a(this).attr('data-step')&&(d.step=3),b.change_step({booking_detail:d,sub_action:'update_sidebar'})},1e3)),b.form.on('change','input[name="payment-type"]',function(){var b=a(this).closest('.tourmaster-tour-booking-bar-total-price-wrap'),c=b.siblings('.tourmaster-tour-booking-bar-deposit-text');c.length==0&&(c=b.children('.tourmaster-tour-booking-bar-deposit-text')),a(this).is(':checked')&&(a(this).val()=='full'?(b.removeClass('tourmaster-deposit'),c.slideUp(200),typeof window.tourmaster_payment_type!='undefined'&&(window.tourmaster_payment_type='full',window.tourmaster_paypal_pay_amount=window.tourmaster_paypal_full_amount)):a(this).val()=='partial'&&(b.addClass('tourmaster-deposit'),c.slideDown(200),typeof window.tourmaster_payment_type!='undefined'&&(window.tourmaster_payment_type='partial',window.tourmaster_paypal_pay_amount=window.tourmaster_paypal_deposit_amount)))})},animate_content:function(a,b){var c=a.outerHeight(),d;a.html(b),d=a.outerHeight(),a.css({height:c}),a.animate({height:d},function(){a.css({height:'auto'},1e3)})},bind_script_recurring:function(){var b=this;b.content.find('#tourmaster-payment-method-or').each(function(){var b=(a(this).width()-a(this).children('.tourmaster-middle').width()-40)/2;a(this).children('.tourmaster-left, .tourmaster-right').css('width',b)}),a(window).resize(function(){b.content.find('#tourmaster-payment-method-or').each(function(){var b=(a(this).width()-a(this).children('.tourmaster-middle').width()-40)/2;a(this).children('.tourmaster-left, .tourmaster-right').css('width',b)})}),b.paypal_jssdk_payment()},bind_script:function(){var b=this;b.form.on('change input','[data-max-unit]',function(){parseInt(a(this).val())>parseInt(a(this).attr('data-max-unit'))&&a(this).val(a(this).attr('data-max-unit'))}),b.sidebar.on('click','#tourmaster-tour-booking-bar-price-breakdown-link',function(){a(this).siblings('.tourmaster-price-breakdown').slideToggle(200)}),b.sidebar.on('click','.tourmaster-tour-booking-bar-date-edit',function(){var c=a(this).siblings('form'),d=b.get_booking_detail();c.append(a('<input name="tour_temp" />').val(JSON.stringify(d))),c.submit()}),b.sidebar.on('click','.tourmaster-tour-booking-bar-coupon-validate',function(){var d=a(this).siblings('[name="coupon-code"]'),c=a(this).siblings('.tourmaster-tour-booking-coupon-message');a.ajax({type:'POST',url:a(this).attr('data-ajax-url'),data:{coupon_code:d.val(),tour_id:a(this).attr('data-tour-id'),action:'tourmaster_validate_coupon_code',tid:a(this).attr('data-tid')},dataType:'json',beforeSend:function(){d.animate({opacity:.3}),c.slideUp(150),c.removeClass('tourmaster-success tourmaster-failed')},error:function(a,b,c){console.log(a,b,c)},success:function(a){if(d.animate({opacity:1}),a.status=='success'){var e=b.get_booking_detail();b.change_step({booking_detail:e,sub_action:'update_sidebar'})}else c.addClass('tourmaster-'+a.status),c.html(a.message),c.slideDown(150)}})}),b.content.on('click','#tourmaster-payment-billing-copy',function(){var b,c;a(this).is(':checked')&&(b=a(this).closest('.tourmaster-payment-billing-wrap'),c=b.siblings('.tourmaster-payment-contact-wrap'),b.find('[data-contact-detail]').each(function(){var b=c.find('[name="'+a(this).attr('data-contact-detail')+'"]');a(this).val(b.val())}))}),b.content.on('click','[data-tmlb]',function(){var b=a(this).siblings('[data-tmlb-id="'+a(this).attr('data-tmlb')+'"]');tourmaster_lightbox(b.clone())}),b.content.on('click','[data-method]',function(){var c,d,e;b.check_required_field(4)&&(c=a(this).attr('data-action'),d=a(this).attr('data-action-type'),a(this).attr('data-method')=='ajax'&&(e=b.get_booking_detail(),b.change_step({action:c,type:d,booking_detail:e})))}),b.content.on('click','.goodlayers-payment-plugin-complete',function(){b.change_step({action:'tourmaster_payment_plugin_complete',step:4})}),b.sidebar.on('click','.tourmaster-pay-now, .tourmaster-pay-woocommerce',function(){var d,c,e;b.check_required_field(4)&&(d='tourmaster_payment_selected',a(this).is('.tourmaster-pay-now')?(c=a(this).closest('.tourmaster-tour-booking-side-payment-wrap').find('.tourmaster-payment-selection').val()):(c='woocommerce'),e=b.get_booking_detail(),b.change_step({action:d,type:c,booking_detail:e}))})},paypal_jssdk_payment:function(){var b=this,c=a('#paypal-button-container');c.length&&typeof paypal!='undefined'&&paypal.Buttons({createOrder:(c,a)=>!!b.check_required_field(4)&&a.order.create({purchase_units:[{amount:{currency_code:window.tourmaster_paypal_currency_code,value:window.tourmaster_paypal_pay_amount}}]}),onApprove:(c,a)=>a.order.capture().then(function(a){b.change_step({action:'tourmaster_payment_selected',type:'paypal',paypal_type:'js-sdk',order_data:a,booking_detail:b.get_booking_detail()})})}).render('#paypal-button-container')},check_required_field:function(e){var d=this,b=!1,c=d.form.find('.tourmaster-tour-booking-required-error'),f;return c.length&&(c.slideUp(200),e==3&&(d.form.find('input[data-required], select[data-required], textarea[data-required]').each(function(){var c;a(this).val()?a(this).is('[type="email"]')?(c=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,c.test(a(this).val().toLowerCase())||(a(this).addClass('tourmaster-validate-error'),b='email')):a(this).is('[name="phone"], [name="billing_phone"]')&&(c=/^[\d\+\-\s\(\)\.]*$/,c.test(a(this).val().toLowerCase())||(a(this).addClass('tourmaster-validate-error'),b='phone')):(a(this).addClass('tourmaster-validate-error'),b='default'),b||a(this).removeClass('tourmaster-validate-error')}),b&&(c.html(c.data(b)),c.slideDown(200),f=c.offset().top-a(window).height()+200,f>0&&a('html, body').animate({scrollTop:f},600,'easeOutQuad'))),e==4&&d.form.find('[name="term-and-service"]').each(function(){a(this).prop('checked')||(b='default',c.html(c.data(b)),c.slideDown(200))})),b===!1},get_booking_detail:function(){var a=this,b={},d,e;a.form.attr('data-booking-detail')&&(b=JSON.parse(a.form.attr('data-booking-detail'))),d=c(a.form);for(e in d)b[e]=d[e];return a.form.attr('data-booking-detail',JSON.stringify(b)),b},change_step:function(c,d){var b=this;c=a.extend({action:'tourmaster_payment_template'},c),d=a.extend({beforeSend:function(){(typeof c.sub_action=='undefined'||c.sub_action!='update_sidebar')&&(b.content.animate({opacity:.1}),a('html, body').animate({scrollTop:b.payment_template.offset().top},600,'easeOutQuad')),b.sidebar.animate({opacity:.1})},error:function(a,b,c){console.log(a,b,c)},success:function(d){var f,e;typeof d.content!='undefined'&&b.animate_content(b.content,d.content),typeof d.sidebar!='undefined'&&b.animate_content(b.sidebar,d.sidebar),typeof d.cookie!='undefined'&&(f=JSON.stringify(d.cookie),tourmaster_set_cookie('tourmaster-booking-detail',f,0),b.form.attr('data-booking-detail',f)),(typeof c.booking_detail!='undefined'||typeof c.step!='undefined')&&(typeof c.step!='undefined'?(e=c.step):(e=c.booking_detail.step),b.payment_step.find('.tourmaster-payment-step-item').each(function(){e==4?a(this).addClass('tourmaster-checked').removeClass('tourmaster-current tourmaster-enable'):a(this).attr('data-step')==1?a(this).addClass('tourmaster-checked').removeClass('tourmaster-current tourmaster-enable'):a(this).attr('data-step')==e?a(this).addClass('tourmaster-current').removeClass('tourmaster-checked tourmaster-enable'):a(this).attr('data-step')<e?a(this).addClass('tourmaster-enable').removeClass('tourmaster-checked tourmaster-current'):a(this).removeClass('tourmaster-checked tourmaster-current tourmaster-enable')})),b.content.animate({opacity:1}),b.sidebar.animate({opacity:1}),b.bind_script_recurring()}},d),a.ajax({type:'POST',url:b.form.attr('data-ajax-url'),data:c,dataType:'json',beforeSend:d.beforeSend,error:d.error,success:d.success})}},a.fn.tourmaster_single_review=function(){var g=a(this),f=a(this).find('#tourmaster-single-review-filter'),b=a(this).find('#tourmaster-single-review-content'),c=f.find('[data-sort-by]'),d=f.find('#tourmaster-filter-by');c.on('click',function(){if(a(this).hasClass('tourmaster-active'))return!1;a(this).addClass('tourmaster-active').siblings('[data-sort-by]').removeClass('tourmaster-active'),e({action:'get_single_tour_review',tour_id:b.attr('data-tour-id'),sort_by:a(this).attr('data-sort-by'),filter_by:d.val()},b)}),d.on('change',function(){e({action:'get_single_tour_review',tour_id:b.attr('data-tour-id'),sort_by:c.filter('.tourmaster-active').attr('data-sort-by'),filter_by:a(this).val()},b)}),b.on('click','[data-paged]',function(){e({action:'get_single_tour_review',tour_id:b.attr('data-tour-id'),paged:a(this).attr('data-paged'),sort_by:c.filter('.tourmaster-active').attr('data-sort-by'),filter_by:d.val()},b,g)})};function e(d,b,c=null){b.animate({opacity:.2},200),a.ajax({type:'POST',url:b.attr('data-ajax-url'),data:d,dataType:'json',error:function(a,c,d){b.animate({opacity:1},200),console.log(a,c,d)},success:function(d){var e,f;typeof d.content!='undefined'&&(e=b.outerHeight(),b.html(d.content),f=b.outerHeight(),b.css({height:e}),b.animate({height:f},200,function(){b.css({height:'auto'})})),b.animate({opacity:1},200),c!=null&&a('body, html').animate({scrollTop:c.offset().top-150})}})}a(document).ready(function(){var b=a('body'),d;b.find('.tourmaster-tour-search-filter-clear').on('click',function(){var b=a(this).closest('form');return b.find('.tourmaster-rating-select[data-rating-score="0"]').trigger('click'),b.find('input[type="text"], select, input[name="rating"]').val(''),b.find('input[type="checkbox"]').removeAttr('checked'),!1}),b.hasClass("rtl")?a('[data-rel=tipsy]').tipsy({fade:!0,gravity:'sw'}):a('[data-rel=tipsy]').tipsy({fade:!0,gravity:'se'}),new gdlr_core_sync_height(a('body'),a('.tourmaster-tour-content-wrap.gdlr-core-js')),a('.tourmaster-center-tour-content').each(function(){var c=a(this).siblings('.tourmaster-content-left').outerHeight(),b;a(this).css({'padding-top':0,'padding-bottom':0}),b=(c-a(this).outerHeight())/2,b=b>0?b:0,a(this).css({'padding-top':b,'padding-bottom':b}),a(window).resize(function(){var c=a(this).siblings('.tourmaster-content-left').outerHeight(),b;a(this).css({'padding-top':0,'padding-bottom':0}),b=(c-a(this).outerHeight())/2,b=b>0?b:0,a(this).css({'padding-top':b,'padding-bottom':b})})}),d=a('.tourmaster-tour-search-item'),d.length&&(tourmaster_rating(d),d.find('.tourmaster-type-filter-title i').click(function(){var b=a(this).parent().siblings('.tourmaster-type-filter-item-wrap');a(this).hasClass('tourmaster-active')?(a(this).removeClass('tourmaster-active'),b.slideUp(200)):(a(this).addClass('tourmaster-active'),b.slideDown(200))})),a('.tourmaster-datepicker').tourmaster_datepicker(),b.hasClass('single-tour')?(a('.tourmaster-single-tour-read-more-wrap .tourmaster-button').on('click',function(){var b=a(window).scrollTop();return a(this).hide(),a(this).parent().parent().siblings('.tourmaster-single-tour-read-more-gradient').hide(),a(this).closest('.tourmaster-single-tour-content-wrap').css({'max-height':'none','margin-bottom':0}),a('html, body').scrollTop(b),!1}),a('#tourmaster-single-tour-booking-fields').tourmaster_tour_booking(),a('#tourmaster-tour-booking-bar-wrap').tourmaster_tour_booking_sticky(),a('#tourmaster-enquiry-form').find('input[type="submit"]').click(function(){var b,f,d,e,g;return!a(this).hasClass('tourmaster-now-loading')&&(b=a(this).closest('form'),f=a(this),d=b.find('.tourmaster-enquiry-form-message').not('.tourmaster-enquiry-term-message'),e=b.find('[name="tourmaster-require-acceptance"]'),e.length&&!e.is(':checked')?(e.siblings('.tourmaster-enquiry-form-message').slideDown(150),!1):(e.siblings('.tourmaster-enquiry-form-message').slideUp(150),g=!0,b.find('input[data-required], select[data-required], textarea[data-required]').each(function(){a(this).val()||(g=!1)}),g?(d.slideUp(300),f.addClass('tourmaster-now-loading'),a.ajax({type:'POST',url:b.attr('data-ajax-url'),data:{action:b.attr('data-action'),data:c(b)},dataType:'json',error:function(a,b,c){console.log(a,b,c)},success:function(a){typeof grecaptcha!='undefined'&&b.find('#g-recaptcha-response').val('gdlr-verfied'),f.removeClass('tourmaster-now-loading'),typeof a.message!='undefined'&&(a.status=='success'?(b.find('input[name], textarea[name], select[name]').not('[name="tour-id"]').val(''),d.removeClass('tourmaster-failed').addClass('tourmaster-success')):d.removeClass('tourmaster-success').addClass('tourmaster-failed'),d.html(a.message),d.slideDown(300))}})):b.attr('data-validate-error')&&(d.removeClass('tourmaster-success').addClass('tourmaster-failed'),d.html(b.attr('data-validate-error')),d.slideDown(300)),!1))}),a('#tourmaster-save-wish-list').click(function(){if(a(this).hasClass('tourmaster-active'))return;a(this).addClass('tourmaster-active'),a.ajax({type:'POST',url:a(this).attr('data-ajax-url'),data:{action:'tourmaster_add_wish_list','tour-id':a(this).attr('data-tour-id')},dataType:'json'})}),a('#tourmaster-single-review').tourmaster_single_review(),a('#tourmaster-urgency-message').click(function(){var b=a(this).attr('data-expire');b||(b=3600),tourmaster_set_cookie('tourmaster-urgency-message','1',b),a(this).fadeOut(200,function(){a(this).remove()})}),a('.tourmaster-single-tour-booking-fields').on('click','.tourmaster-combobox-list-display',function(){a(this).siblings('ul').fadeToggle(200)}),a('.tourmaster-single-tour-booking-fields').on('click','.tourmaster-combobox-list-wrap ul li',function(){var b=a(this).attr('data-value');a(this).closest('ul').fadeOut(200),a(this).closest('ul').siblings('input').val(b).trigger('change'),a(this).closest('ul').siblings('.tourmaster-combobox-list-display').children('span').html(b)}),a(document).mouseup(function(c){var b=a('.tourmaster-combobox-list-wrap');b.length&&!b.is(c.target)&&b.has(c.target).length===0&&b.find('ul').fadeOut(200)}),a('#tourmaster-booking-tab-title').children().click(function(){if(a(this).hasClass('tourmaster-active'))return!1;a(this).addClass('tourmaster-active').siblings().removeClass('tourmaster-active');var b=a(this).attr('data-tourmaster-tab');a(this).parent().siblings('.tourmaster-booking-tab-content').each(function(){a(this).is('[data-tourmaster-tab="'+b+'"]')?a(this).fadeIn(200,function(){a(this).addClass('tourmaster-active')}):a(this).removeClass('tourmaster-active').hide()})})):b.hasClass('tourmaster-template-payment')&&new g}),a(window).on('load',function(){var e=a('body'),c=a('#tourmaster-content-navigation-item-outer'),f,g,d;!e.is('.wp-admin')&&c.length&&(window.traveltour_anchor_offset=c.height(),f=c.parent(),g=parseInt(a('html').css('margin-top')),d=c.find('.tourmaster-content-navigation-slider'),c.find('.tourmaster-active').each(function(){d.css({width:a(this).outerWidth(),left:a(this).position().left})}),c.on('tourmaster-change',function(){var b=a(this).find('.tourmaster-active');b.hasClass('tourmaster-slidebar-active')||(b.addClass('tourmaster-slidebar-active'),d.animate({width:b.outerWidth(),left:b.position().left},{queue:!1,duration:200}))}),a(window).resize(function(){c.trigger('tourmaster-change')}),c.each(function(){a(this).find('.tourmaster-content-navigation-tab').hover(function(){d.animate({width:a(this).outerWidth(),left:a(this).position().left},{queue:!1,duration:150})},function(){var b=a(this).parent().children('.tourmaster-slidebar-active');b.length&&d.animate({width:b.outerWidth(),left:b.position().left},{queue:!1,duration:150})})}),a(window).scroll(function(){if(b=='mobile-landscape'||b=='mobile-portrait'||b=='tablet')return;a(this).scrollTop()+g>f.offset().top?c.hasClass('tourmaster-fixed')||(c.parent().css('height',c.parent().height()),c.addClass('tourmaster-fixed'),window.traveltour_anchor_offset=c.height()):c.hasClass('tourmaster-fixed')&&(c.parent().css('height','auto'),c.removeClass('tourmaster-fixed'))}))})})(jQuery),!function(a){function b(a,b){return"function"==typeof a?a.call(b):a}function d(a){for(;a=a.parentNode;)if(a==document)return!0;return!1}function c(b,c){this.$element=a(b),this.options=c,this.enabled=!0,this.fixTitle()}c.prototype={show:function(){var i=this.getTitle(),d,e,c,g,h,f;if(i&&this.enabled){switch(d=this.tip(),d.find(".tipsy-inner")[this.options.html?"html":"text"](i),d[0].className="tipsy",d.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body),c=a.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight}),g=d[0].offsetWidth,h=d[0].offsetHeight,f=b(this.options.gravity,this.$element[0]),f.charAt(0)){case"n":e={top:c.top+c.height+this.options.offset,left:c.left+c.width/2-g/2};break;case"s":e={top:c.top-h-this.options.offset,left:c.left+c.width/2-g/2};break;case"e":e={top:c.top+c.height/2-h/2,left:c.left-g-this.options.offset};break;case"w":e={top:c.top+c.height/2-h/2,left:c.left+c.width+this.options.offset}}2==f.length&&("w"==f.charAt(1)?e.left=c.left+c.width/2-15:e.left=c.left+c.width/2-g+15),d.css(e).addClass("tipsy-"+f),d.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+f.charAt(0),this.options.className&&d.addClass(b(this.options.className,this.$element[0])),this.options.fade?d.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity}):d.css({visibility:"visible",opacity:this.options.opacity})}},hide:function(){this.options.fade?this.tip().stop().fadeOut(function(){a(this).remove()}):this.tip().remove()},fixTitle:function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("original-title"))&&a.attr("original-title",a.attr("title")||"").removeAttr("title")},getTitle:function(){var b,c=this.$element,a=this.options;return this.fixTitle(),a=this.options,"string"==typeof a.title?b=c.attr("title"==a.title?"original-title":a.title):"function"==typeof a.title&&(b=a.title.call(c[0])),b=(""+b).replace(/(^\s*|\s*$)/,""),b||a.fallback},tip:function(){return this.$tip||(this.$tip=a('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>'),this.$tip.data("tipsy-pointee",this.$element[0])),this.$tip},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled}},a.fn.tipsy=function(b){var e,f,g,h;function d(d){var e=a.data(d,"tipsy");return e||(e=new c(d,a.fn.tipsy.elementOptions(d,b)),a.data(d,"tipsy",e)),e}function i(){var a=d(this);a.hoverState="in",0==b.delayIn?a.show():(a.fixTitle(),setTimeout(function(){"in"==a.hoverState&&a.show()},b.delayIn))}function j(){var a=d(this);a.hoverState="out",0==b.delayOut?a.hide():setTimeout(function(){"out"==a.hoverState&&a.hide()},b.delayOut)}return b===!0?this.data("tipsy"):"string"==typeof b?(e=this.data("tipsy"),e&&e[b](),this):(b=a.extend({},a.fn.tipsy.defaults,b),b.live||this.each(function(){d(this)}),"manual"!=b.trigger&&(f=b.live?"live":"bind",g="hover"==b.trigger?"mouseenter":"focus",h="hover"==b.trigger?"mouseleave":"blur",this[f](g,i)[f](h,j)),this)},a.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:!1,fallback:"",gravity:"n",html:!1,live:!1,offset:0,opacity:.8,title:"title",trigger:"hover"},a.fn.tipsy.revalidate=function(){a(".tipsy").each(function(){var b=a.data(this,"tipsy-pointee");b&&d(b)||a(this).remove()})},a.fn.tipsy.elementOptions=function(c,b){return a.metadata?a.extend({},b,a(c).metadata()):b},a.fn.tipsy.autoNS=function(){return a(this).offset().top>a(document).scrollTop()+a(window).height()/2?"s":"n"},a.fn.tipsy.autoWE=function(){return a(this).offset().left>a(document).scrollLeft()+a(window).width()/2?"e":"w"},a.fn.tipsy.autoBounds=function(b,c){return function(){var d={ns:c[0],ew:c.length>1&&c[1]},f=a(document).scrollTop()+b,g=a(document).scrollLeft()+b,e=a(this);return e.offset().top<f&&(d.ns="n"),e.offset().left<g&&(d.ew="w"),a(window).width()+a(document).scrollLeft()-e.offset().left<b&&(d.ew="e"),a(window).height()+a(document).scrollTop()-e.offset().top<b&&(d.ns="s"),d.ns+(d.ew?d.ew:"")}}}(jQuery)